<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta content="webthemez" name="author" />
    <title>教师管理</title>
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FontAwesome Styles-->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <!-- Custom Styles-->
    <link href="assets/css/custom-styles.css" rel="stylesheet" />
    <!-- Google Fonts-->
    <link href="assets/css/font-goole.css" rel='stylesheet' type='text/css' />
    <script src="assets/js/jquery-1.10.2.js"></script>
    <!-- Bootstrap Js -->
    <script src="assets/js/bootstrap.min.js"></script>
    <!-- TABLE STYLES-->
    <link href="assets/js/dataTables/dataTables.bootstrap.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="assets/css/sweetalert.css"/>
    <script src="assets/js/sweetalert.min.js" type="text/javascript" charset="utf-8"></script>
    <script>
      $(document).ready(function(){
        $("#video").removeClass("active-menu");
        $("#teach").addClass("active-menu");

        $("#sideNav").click(function(){
          if($(this).hasClass('closed')){
            $('.navbar-side').animate({left: '0px'});
            $(this).removeClass('closed');
            $('#page-wrapper').animate({'margin-left' : '290px'});

          }
          else{
            $(this).addClass('closed');
            $('.navbar-side').animate({left: '-290px'});
            $('#page-wrapper').animate({'margin-left' : '0px'});
          }
        });

      });
    </script>
    <style>
        section {
            width: 90%;
            margin: auto;
            text-align: left;
        }
    </style>
</head>

<body>
<div id="wrapper">
    <div id="slid"></div>
    <div id="header"></div>
    <div id="page-wrapper" style=" margin: 0 0 0 290px;">
        <ol class="breadcrumb">
            <li class="active">教师管理</li>
        </ol>
        <div id="page-inner">

            <div class="row">
                <div class="col-md-12">
                    <!-- Advanced Tables -->
                    <div class="panel panel-primry">
                        <div class="panel-head" style="position: relative; top:10px;left: 15px;">
                            <button class="btn btn-primary" data-toggle="modal" data-target="#myModal">新增教师</button>
                            <button type="submit" class="btn btn-primary" onclick="openPermission()">开启考核权限</button>
                            <button type="submit" class="btn btn-primary" onclick="closePermission()">关闭考核权限</button>
                        </div>
                        <div class="panel-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover" id="example1" >
                                    <thead>
                                    <tr>
                                        <th class="table-check"><input type="checkbox" name="selectAll" /></th>
                                        <th>工号</th>
                                        <th>姓名</th>
                                        <th>电话</th>
                                        <th>添加时间</th>
                                        <th>考核权限</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody id="teacher_list">

                                    <tr class="gradeA">
                                        <td><input type="checkbox" value="1" name="selectOne"/></td>
                                        <td>Gecko</td>
                                        <td>Firefox 1.5</td>
                                        <td>Win 98+ / OSX.2+</td>
                                        <td class="center">1.8</td>
                                        <td class="center">
                                            <button class="btn btn-primary" data-toggle="modal" data-target="#myModal2">修改</button>
                                            <button type="submit" class="btn btn-warning" id="reset">重置</button>
                                            <button type="button" class="btn btn-danger" id="delete">删除</button>
                                        </td>
                                    </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!--End Advanced Tables -->
                </div>
            </div>
            <!-- /. ROW  -->

        </div><!--/.pager-inner-->

        <div id="footer"></div>

    </div><!--/.page-wrapper-->

</div><!--/.wrapper-->
<!--新增模态框-->
<div class="add_modal"><!--包裹新增的模态框-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">新增教师</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="techNumber" class="col-sm-2 control-label">工号</label>
                        <div class="col-sm-10">
                            <input type="name" class="form-control" id="inputnumber" placeholder="">
                        </div>
                    </div><br />

                    <div class="form-group">
                        <label for="techName" class="col-sm-2 control-label">姓名</label>
                        <div class="col-sm-10">
                            <input type="name" class="form-control" id="inputname" placeholder="">
                        </div>
                    </div><br />

                    <div class="form-group">
                        <label for="techPhone" class="col-sm-2 control-label">电话</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="inputphone"  placeholder="">
                        </div>
                    </div><br />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary"  id="add_teacher">添加</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
</div>

<div class="update_modal"><!--包裹修改的模态框-->
    <!--修改模态框-->
    <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">修改教师信息</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="Number" class="col-sm-2 control-label">工号</label>
                        <div class="col-sm-10">
                            <input type="name" class="form-control" id="pk" pkAdm="">
                        </div>
                    </div><br />

                    <div class="form-group">
                        <label for="username" class="col-sm-2 control-label">姓名</label>
                        <div class="col-sm-10">
                            <input type="name" class="form-control" id="name" placeholder="">
                        </div>
                    </div><br />

                    <div class="form-group">
                        <label for="phone" class="col-sm-2 control-label">电话</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="tele"  placeholder="">
                        </div>
                    </div><br />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="editTeacher">
                        提交更改
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->

    </div>
</div>

<script src="assets/js/froala_editor.min.js"></script>
<script type="text/javascript" src="assets/js/head/loader_admin.js"></script>
<script src="assets/js/dataTables/jquery.dataTables.js"></script>
<script src="assets/js/dataTables/dataTables.bootstrap.js"></script>
<script>
  /* 绑定全选按钮 */
  $(':checkbox[name=selectAll]').click(function(){
    if(this.checked){
      $(':checkbox').prop("checked",true);
    }else{
      $(':checkbox').prop("checked",false) ;
    }
  });
  
  //获取多选值
  function getCheckboxVal(){
  // var arr=document.getElementsByName("name");
    var arr=$(':checkbox[name=selectOne]')
    var arr2=[];
    for(i=0;i<arr.length;i++){
      if(arr[i].checked){
        var a = parseInt(arr[i].getAttribute('teacherId'));
        arr2.push(a);
      }
    }
    return arr2;
  }

  //开启考核权限
  function openPermission() {
    swal({
        title: "确定要开启考核权限吗？",
        // text: "一旦重置，不可撤销操作！",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        confirmButtonText: "确认重置",
        closeOnConfirm: false
      },
      function(){
        var teacherIds=getCheckboxVal();
        $.ajax({
          type : "PATCH",
          url : host+"/api/teachers/on",
          data: {teacherIds:teacherIds},
          success : function(data) {

            if(data.code == "200") {
              swal(
                '重置成功！',
                '该用户密码已经重置。',
                'success'
              );
            }
          },
          error : function() {
            sweetAlert("出错了！", "与服务器的连接出问题了...","error");
          }
        });

      });
  }
  //关闭考核权限
  function closePermission() {
    swal({
        title: "确定关闭考核权限吗？",
       // text: "一旦，不可撤销操作！",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        confirmButtonText: "确认重置",
        closeOnConfirm: false
      },
      function(){
        var teacherIds=getCheckbobxVal();
        console.log(teacherIds)
        $.ajax({
          type : "PATCH",
          url : host+"/api/teachers/off",
          data: {teacherIds:teacherIds},
          success : function(data) {
            if(data.code == "200") {
              swal(
                '重置成功！',
                '该用户密码已经重置。',
                'success'
              );
              
            }
          },
          error : function() {
            sweetAlert("出错了！", "与服务器的连接出问题了...","error");
          }
        });

      });
  }
  

</script>

</body>
<script type="text/javascript">

  //显示教师列表，未连上服务器则提示
  $(document).ready(function() {
    $.ajax({
      type : "GET",
      url : "http://10.21.30.218:8080/api/teachers",
      contentType : "application/json",
      dataType : "json",
      success : function(data) {
//        alert(JSON.stringify(data))
          console.log(data)
        if (data.code == "200") {
          showList(data);

        }
      },
      error :function () {
        sweetAlert("警告", "服务器连接出错！");}
    });
    setTimeout(function(){$('#example1').dataTable({
      "lengthChange": false,//页数选择功能关闭
      "sPaginationType" : "full_numbers",//显示首页和尾页
      "aaSorting" : [[4, "desc"]], //默认的排序方式：第5列降序排列。即按时间倒序排列
    });},500)

  });

  //新增教师
  $("#add_teacher").click(function check(){
    inputname=$("#inputname").val();
    inputnumber=$("#inputnumber").val();
    inputphone=$("#inputphone").val();
    if(inputnumber==""){
      swal("提示","请输入教师工号!");return false;
    }
    else if(inputname==""){
      swal("提示","请输入教师姓名！");return false;
    }else if(inputphone==""){
      swal("提示","请输入教师电话！");return false;
    }
    var content={};

    content["teacherName"]=inputname; //json数据里的字段 同nei
    content["teacherNumber"]=inputnumber;
    content["teacherPhone"]=inputphone;
    $.ajax({
      type : "POST",
      url : "http://10.21.30.218:8080/api/teachers",
      data :JSON.stringify(content),
      contentType : "application/json",
      dataType : "json",
      success : function(data) {
        swal({
          title:"添加成功",
          type:"success"
        },function(){
          setTimeout(function(){window.location.reload();//页面刷新
          },1000);})

      },
      error :function () {
        swal("添加失败","服务器未连接");
      }

    });

  });

  //显示列表
  function showList(data){
    $("#teacher_list").html("");
    $.each(data.data, function(i, value){

      //后端数据处理改名

      if(value.evaluationFlag==0){

        value.permission="未开启";
      }else if(value.evaluationFlag==1){
        value.permission="已开启";
      }
      var createTime=formatDate(value.teacherCreateTime);
      $("#teacher_list").append(

        '<tr><td><input type="checkbox" teacherId="'+value.teacherId+'" name="selectOne"></td><td>'+value.teacherNumber+'</td><td>'+value.teacherName+'</td><td>'+value.teacherPhone+'</td><td>'+createTime+'</td><td>'+value.permission+'</td><td>'+

        '<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal2">'+
        '<span class="glyphicon glyphicon-pencil" pkAdm="'+value.teacherId+'" techNumber="'+value.teacherAccount+'" techName="'+value.teacherName+'" techPhone="'+value.phone+'"  onclick="edit(this);">'+
        '编辑</span></button>'+
        '<button type="button" class="btn btn-warning" id="reset">'+
        '<span  class="glyphicon glyphicon-exclamation-sign" pkAdm="'+value.teacherId+'" onclick="reset(this)">重置密码</span>'+'</button>'+
        '<button type="button" class="btn btn-danger" id="del">'+
        '<span id="reset2" class="glyphicon glyphicon glyphicon-trash" pkAdm="'+value.teacherId+'" onclick="del(this)">删除</span>'+'</button>' +
        '</td></tr>'

      );
    })
  }
  //读取原来的信息
  function edit(node){
    var techId=node.getAttribute("pkAdm");
    var techPhone=node.getAttribute("techPhone");
    var techName=node.getAttribute("techName");
    var techNumber=node.getAttribute("techNumber");
    $("#name").val(techName);
    $("#pk").val(techNumber);
    $("#tele").val(techPhone);
    pk=document.getElementById("pk");
    pk.setAttribute("techId",techId);
//    $("#myModal2").modal({show:true});上面button调用了。

  }
  //提交修改的信息
  $("#editTeacher").click(
    function(){ //匿名函数
      var techName=$("#name").val();
      var techPhone=$("#tele").val();
      var techNumber=$("#pk").val();
      //获取id
      pk=document.getElementById("pk");
      var pkAdm=pk.getAttribute("techId");

      var content={};
      content["teacherNumber"]=techNumber;
      content["teacherName"]=techName;
      content["teacherPhone"]=techPhone;
      content["teacherId"]=pkAdm;
      $.ajax({
        type : "Patch",
        url : "http://10.21.30.218:8080/api/teachers/update",
        data: JSON.stringify(content),
        contentType : "application/json",
        dataType : "json",
        success : function(data) {

          if(data.code == "200") {
            sweetAlert("修改成功！", "教师信息已经修改。","success");
            setTimeout(function(){window.location.reload();//页面刷新
            },1000);
          }

        },
        error : function() {
          sweetAlert("出错了！", "与服务器的连接出问题了...","error");
        }
      });

    })


  //重置为123456
  function reset(node) {
    swal({
        title: "确定重置密码吗？",
        text: "一旦重置，不可撤销操作！",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        confirmButtonText: "确认重置",
        closeOnConfirm: false
      },
      function(){
        var teacherId=node.getAttribute("pkAdm");
        $.ajax({
          type : "PATCH",
          url : "http://10.21.30.218:8080/api/teachers/reset",
          data: {teacherId:teacherId},
         // contentType : "application/json",
         // dataType : "json",
          success : function(data) {

            if(data.code == "200") {
              swal(
                '重置成功！',
                '该用户密码已经重置。',
                'success'
              );
            }
          },
          error : function() {
            sweetAlert("出错了！", "与服务器的连接出问题了...","error");
          }
        });

      });
  }
  //删除教师
  function del(node){
    swal({
        title: "确定删除吗？",
        text: "你将无法恢复该教师账户！",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        confirmButtonText: "确定删除！",
        cancelButtonText: "取消删除！",
        closeOnConfirm: false,
        closeOnCancel: false
      },
      function(isConfirm){
        if (isConfirm) {
          var pkAdm=node.getAttribute("pkAdm");
          $.ajax({
            type : "delete",
            url : "http://10.21.30.218:8080/api/teachers/" + pkAdm,
//            data:{
//              teacherId:pkAdm,
//            },
            contentType : "application/json",
            dataType : "json",
            success : function(data) {
              //alert(JSON.stringify(data));

              if(data.code == "200") {
                sweetAlert("删除成功！", "该教师已经被删除。","success");
                setTimeout(function(){window.location.reload();//页面刷新
                },1000);
              }

            },
            error : function() {
              //如果已被学生选择，不可删除。
              swal("删除失败！", "未能成功删除该教师。") ;
            }
          });
        } else {
          sweetAlert("取消！","","error");
        }
      });
  };

  //修改考核权限
  function updatePermission(node) {
    var techId=node.getAttribute("techId");
    var techPermission=node.getAttribute("permission");

  }


  
</script>

</html>
